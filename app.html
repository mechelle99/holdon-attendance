<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>HR Portal</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --bg: #f3f4f6;
      --surface: #ffffff;
      --text: #1f2937;
      --text-light: #6b7280;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px 20px 100px 20px; }

    /* é ‚éƒ¨æ­¡è¿å€ */
    .header { margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-end; }
    .header h1 { font-size: 28px; font-weight: 800; margin: 0; background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .header .subtitle { font-size: 14px; color: var(--text-light); margin-top: 4px; }
    .btn-logout { font-size: 12px; color: var(--text-light); background: #e5e7eb; padding: 6px 12px; border-radius: 20px; cursor: pointer; }

    /* é¤˜é¡å¡ç‰‡ */
    .balance-card { background: var(--surface); border-radius: 24px; padding: 24px; box-shadow: var(--shadow); display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; position: relative; overflow: hidden; }
    .balance-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(90deg, var(--primary), var(--success)); }
    
    .bal-item { text-align: center; position: relative; }
    .bal-item:first-child::after { content: ''; position: absolute; right: -10px; top: 10%; height: 80%; width: 1px; background: #e5e7eb; }
    .bal-val { font-size: 32px; font-weight: 800; color: var(--text); line-height: 1; margin-bottom: 8px; }
    .bal-label { font-size: 13px; color: var(--text-light); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    /* GPS ç‹€æ…‹ */
    .gps-pill { text-align: center; margin-bottom: 20px; font-size: 13px; background: rgba(37, 99, 235, 0.1); color: var(--primary); padding: 8px 16px; border-radius: 50px; display: inline-block; width: 100%; font-weight: 500; }

    /* æ‰“å¡æŒ‰éˆ•å€ */
    .clock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .clock-btn {
      border: none; border-radius: 24px; padding: 30px 20px; cursor: pointer;
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px;
      transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      position: relative; overflow: hidden;
    }
    .clock-btn:active { transform: scale(0.95); }
    
    .btn-in { background: var(--surface); color: var(--success); border: 2px solid transparent; }
    .btn-in:active { background: #ecfdf5; border-color: var(--success); }
    .btn-out { background: var(--surface); color: var(--warning); border: 2px solid transparent; }
    .btn-out:active { background: #fffbeb; border-color: var(--warning); }

    .icon-large { font-size: 36px; }
    .btn-label { font-size: 16px; font-weight: 700; color: var(--text); }

    /* åº•éƒ¨å°èˆªæ¬„ (Fixed Bottom) */
    .bottom-nav {
      position: fixed; bottom: 20px; left: 20px; right: 20px;
      background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);
      border-radius: 24px; padding: 12px 20px;
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      z-index: 100; border: 1px solid rgba(255,255,255,0.5);
    }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
      color: #9ca3af; text-decoration: none; font-size: 10px; font-weight: 600;
      transition: color 0.3s; padding: 4px 8px;
    }
    .nav-item.active { color: var(--primary); }
    .nav-icon { font-size: 20px; }

  </style>
</head>
<body>

  <div class="header">
    <div>
      <div class="subtitle">Welcome back,</div>
      <h1 id="uName">Loading...</h1>
    </div>
    <div class="btn-logout" onclick="logout()">ç™»å‡º</div>
  </div>

  <div class="balance-card">
    <div class="bal-item">
      <div class="bal-val" id="annBal">--</div>
      <div class="bal-label">ç‰¹ä¼‘é¤˜é¡</div>
    </div>
    <div class="bal-item">
      <div class="bal-val" id="compBal">--</div>
      <div class="bal-label">è£œä¼‘é¤˜é¡</div>
    </div>
  </div>

  <div id="gpsStatus" class="gps-pill">ğŸ“¡ æ­£åœ¨å®šä½ä¸­...</div>

  <div class="clock-grid">
    <button class="clock-btn btn-in" onclick="clock('clock_in')">
      <span class="icon-large">â˜€ï¸</span>
      <span class="btn-label">ä¸Šç­æ‰“å¡</span>
    </button>
    <button class="clock-btn btn-out" onclick="clock('clock_out')">
      <span class="icon-large">ğŸŒ™</span>
      <span class="btn-label">ä¸‹ç­æ‰“å¡</span>
    </button>
  </div>

  <nav class="bottom-nav">
    <a href="app.html" class="nav-item active">
      <span class="nav-icon">ğŸ </span><span>é¦–é </span>
    </a>
    <a href="request.html" class="nav-item">
      <span class="nav-icon">ğŸ“</span><span>ç”³è«‹</span>
    </a>
    <a href="history.html" class="nav-item">
      <span class="nav-icon">ğŸ“‹</span><span>ç´€éŒ„</span>
    </a>
    <a href="schedule.html" class="nav-item">
      <span class="nav-icon">ğŸ“…</span><span>æ’ç­</span>
    </a>
    <a href="manager.html" class="nav-item" id="mgrBtn" style="display:none">
      <span class="nav-icon">ğŸ‘‘</span><span>ä¸»ç®¡</span>
    </a>
  </nav>

<script src="config.js"></script>
<script>
  const uid = localStorage.getItem("employeeId");
  if(!uid) location.href='index.html';

  let lat='', lng='';
  navigator.geolocation.getCurrentPosition(
    p => { 
      lat=p.coords.latitude; lng=p.coords.longitude; 
      const el = document.getElementById('gpsStatus');
      el.innerText='ğŸ“ GPS å·²é–å®š'; el.style.background='rgba(16, 185, 129, 0.1)'; el.style.color='#10b981';
    },
    e => { 
      const el = document.getElementById('gpsStatus');
      el.innerText='âš ï¸ ç„¡æ³•å®šä½'; el.style.background='rgba(239, 68, 68, 0.1)'; el.style.color='#ef4444';
    },
    { enableHighAccuracy:true, timeout:10000 }
  );

  function api(act, data={}) {
    return new Promise(r => {
      const s = document.createElement("script");
      s.src = `${window.CONFIG.GAS_ENDPOINT}?action=${act}&payload=${encodeURIComponent(JSON.stringify({...data, userId:uid}))}&callback=cb${Date.now()}`;
      window[`cb${Date.now()}`] = (res) => { r(res); s.remove(); };
      document.body.appendChild(s);
    });
  }

  async function init() {
      const res = await api("get_me");
      if(res.ok) {
          document.getElementById("uName").innerText = res.name;
          document.getElementById("annBal").innerText = res.balances.annual.left;
          document.getElementById("compBal").innerText = res.balances.comp.left;
          if(res.isManager) document.getElementById("mgrBtn").style.display = 'flex';
      }
  }

  async function clock(type) {
      if(!lat) { alert("è«‹å…ˆç­‰å¾… GPS å®šä½å®Œæˆ"); return; }
      const btn = event.currentTarget;
      btn.style.opacity = 0.5;
      const res = await api(type, {lat, lng});
      alert(res.message);
      btn.style.opacity = 1;
  }

  function logout() { localStorage.clear(); location.href='index.html'; }
  init();
</script>
</body>
</html>
